<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>My家計簿</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="container">
<h1>My家計簿</h1>

<form method="get">
  <select name="month">
    <option value="">すべて表示</option>
    {% for m in months %}
      <option value="{{ m.month }}"
        {% if m.month == selected_month %}selected{% endif %}>
        {{ m.month }}
      </option>
    {% endfor %}
  </select>
  <button type="submit">表示</button>
</form>

<a class="btn" href="{{ url_for('add') }}">＋ 新規入力</a>

<div class="graph-area">
  <canvas id="expenseChart"></canvas>
</div>

<table>
<tr><th>日付</th><th>用途</th><th>金額</th><th>メモ</th><th></th></tr>
{% for e in expenses %}
<tr>
<td>{{ e.date }}</td>
<td>{{ e.category }}</td>
<td>{{ e.amount }}円</td>
<td>{{ e.memo }}</td>
<td><a href="{{ url_for('edit', id=e.id) }}">編集</a></td>
</tr>
{% endfor %}
<tr class="total">
<td colspan="2">合計</td>
<td colspan="3">{{ total }}円</td>
</tr>
</table>
</div>

<script type="application/json" id="chart-data">
{
  "labels": {{ labels | tojson | safe }},
  "values": {{ values | tojson | safe }}
}
</script>

<script>
const chartData = JSON.parse(
  document.getElementById("chart-data").textContent
);

const ctx = document
  .getElementById("expenseChart")
  .getContext("2d");

new Chart(ctx, {
  type: "bar",
  data: {
    labels: chartData.labels,
    datasets: [{
      data: chartData.values,
      backgroundColor: "#4f46e5",
      barPercentage: 0.5,
      categoryPercentage: 0.6
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false }
    }
  }
});
</script>



</body>
</html>
